<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="common/include :: header" ></head>
<style type="text/css">
    .my-layui-tree-txt-active{
        color: #2D93CA;
    }
</style>
<body>
    <div class="layui-form">
        <button class="layui-btn layui-btn-sm layui-btn-normal refreshBtn"><i class="layui-icon layui-icon-refresh-3"></i>刷新</button>
        <button id="openAddLayer"  class="layui-btn layui-btn-sm layui-btn-normal openAddLayer"><i class="layui-icon layui-icon-add-1"></i>添加</button>
        <button id="deleteLayer"  class="layui-btn layui-btn-sm layui-btn-normal openAddLayer"><i class="layui-icon layui-icon-delete"></i>删除</button>
        <button id="openEditLayer"  class="layui-btn layui-btn-sm layui-btn-normal openAddLayer"><i class="layui-icon layui-icon-edit"></i>编辑</button>
    </div>
    <div id="tree" >

    </div>
<script th:inline="javascript">
    var treeData = [[${categoryTree}]];
    var checkedTreeData ;
    layui.use(['tree','layer','form'],function() {
        var tree = layui.tree;
        var layer = layui.layer;
        var $ = layui.jquery;

        tree.render({
           elem:'#tree',
           data:treeData,
           click:function(obj){
               console.log(obj.data); //得到当前点击的节点数据
               $(".layui-tree-txt").removeClass("my-layui-tree-txt-active")
               obj.elem.find(".layui-tree-txt:first").addClass("my-layui-tree-txt-active");
               checkedTreeData =obj;
           }
        });
        $("#openAddLayer").on('click',function () {
            if(!checkedTreeData){
                layer.open({
                    title:'提示',
                    content:'请点击选择父级类别！'
                });
            }
            layer.open({
                type:2,
                title:'添加类别',
                content:ctx+'sys/category/addOrEditInit?parId='+checkedTreeData.data.id+"&parTitle="+checkedTreeData.data.title,
                area:['1000px','600px'],
                maxmin:true,
                fixed: false  //不固定

            });
        });

        $("#deleteLayer").click(function(){
            if(!checkedTreeData){
                layer.open({
                    title:'提示',
                    content:'请点击选择类别！'
                });
            }else{
                var index = layer.open({
                    title:'提示',
                    content:'确认删除类别：'+checkedTreeData.data.title,
                    btn:['确认','删除'],
                    btn1:function () {
                        $.ajax({
                            url:ctx+"sys/category/delete",
                            type:"POST",
                            data:{id:checkedTreeData.data.id},
                            dataType:"json",
                            success:function (res) {
                                layer.open({
                                    title:"提示",
                                    content:res.message
                                })
                            }
                        })
                    },
                    btn2:function () {
                        layer.close(index);
                    }
                })
            }
        });
        
        $("#openEditLayer").click(function () {
            if(!checkedTreeData){
                layer.open({
                    title:'提示',
                    content:'请点击选择类别！'
                });
            }else{
                layer.open({
                    type:2,
                    title:'编辑类别',
                    content:ctx+'sys/category/addOrEditInit?id='+checkedTreeData.data.id,
                    area:['1000px','600px'],
                    fixed: false  //不固定
                })
            }
        })
    });

</script>

</body>
</html>